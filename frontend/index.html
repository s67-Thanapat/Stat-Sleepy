<!-- =========================
File: /index.html (‡∏´‡∏ô‡πâ‡∏≤ Main)
========================= -->
<!doctype html>
<html lang="th" translate="no">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>SleepStats ‚Ä¢ ‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å</title>
  <link rel="stylesheet" href="./css/styles.css" />

  <style>
    /* TOP BAR */
    .topbar {
      background: linear-gradient(90deg, #0b5bd3, #23a6ff);
      color: #fff;
      font-size: 14px;
      padding: 6px 0
    }

    .topbar .wrap {
      max-width: 1080px;
      margin: 0 auto;
      padding: 0 16px;
      display: flex;
      align-items: center;
      gap: 12px;
      justify-content: space-between
    }

    .tb-left,
    .tb-right {
      display: flex;
      align-items: center;
      gap: 12px;
      flex-wrap: wrap
    }

    .tb-link {
      color: #fff;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 10px;
      border-radius: 10px
    }

    .tb-link:hover {
      background: rgba(255, 255, 255, .12)
    }

    .tb-search {
      display: flex;
      align-items: center;
      gap: 0;
      background: #fff;
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 2px 10px rgba(0, 0, 0, .15)
    }

    .tb-search input {
      border: 0;
      outline: 0;
      padding: 8px 12px;
      min-width: 240px;
      font-size: 14px
    }

    .tb-search button {
      border: 0;
      background: #0b5bd3;
      color: #fff;
      padding: 8px 12px;
      cursor: pointer
    }

    /* NAVBAR */
    .nav-main {
      background: #fff;
      color: #0b0c10;
      border-bottom: 1px solid rgba(0, 0, 0, .08);
      position: sticky;
      top: 0;
      z-index: 50
    }

    .nav-inner2 {
      max-width: 1080px;
      margin: 0 auto;
      padding: 10px 16px;
      display: flex;
      align-items: center;
      gap: 16px
    }

    .brand {
      font-weight: 800;
      letter-spacing: .2px;
      color: inherit;
      text-decoration: none;
      display: flex;
      align-items: center;
      gap: 10px
    }

    .brand img {
      height: 42px;
      width: auto;
      display: block
    }

    .menu2 {
      display: flex;
      align-items: center;
      gap: 16px;
      margin-left: auto;
      flex-wrap: wrap
    }

    .menu2 a {
      color: #0b0c10;
      text-decoration: none;
      padding: 8px 10px;
      border-radius: 12px;
      border: 1px solid transparent
    }

    /* FIX: menu hover readable */
    .nav-main .menu2 a:hover,
    .nav-main .menu2 a:focus-visible {
      background: rgba(2, 81, 250, 0.06);
      color: #0b0c10;
      /* ‡∏¢‡πâ‡∏≥‡∏™‡∏µ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£‡πÉ‡∏´‡πâ‡∏ä‡∏±‡∏î ‡πÑ‡∏°‡πà‡πÇ‡∏î‡∏ô a:hover ‡∏≠‡∏∑‡πà‡∏ô‡∏Ñ‡∏£‡∏≠‡∏ö */
      border-color: rgba(0, 0, 0, .08);
      outline: 0;
    }

    .nav-main .menu2 a.active {
      background: #e8eefc;
      color: #1e40af;
      border-color: rgba(37, 99, 235, .25);
      font-weight: 600;
    }

    .btn {
      border: 1px solid rgba(0, 0, 0, .1);
      background: #f6f7f9;
      padding: 8px 12px;
      border-radius: 12px;
      text-decoration: none
    }

    .btn-primary {
      background: #fff;
      color: #fff;
      border-color: transparent
    }

    .btn-primary:hover {
      filter: brightness(.95)
    }

    /* auth status */
    #authUser {
      display: flex;
      align-items: center;
      gap: 8px;
      color: #075fec;
      font-weight: 600
    }

    .avatar {
      width: 26px;
      height: 26px;
      display: inline-grid;
      place-items: center;
      border-radius: 50%;
      background: #2563eb;
      color: #fff;
      font-weight: 700
    }

    /* mobile */
    .hamburger {
      display: none;
      margin-left: auto;
      font-size: 20px;
      background: none;
      border: none;
      padding: 8px 10px;
      border-radius: 10px
    }

    @media (max-width:820px) {
      .tb-search input {
        min-width: 140px
      }

      .hamburger {
        display: block
      }

      .menu2 {
        display: none;
        width: 100%;
        flex-direction: column;
        align-items: flex-start;
        padding-top: 8px
      }

      .menu2.open {
        display: flex
      }
    }

    /* HERO/CONTAINER */
    .container {
      max-width: 1080px;
      margin: 0 auto;
      padding: 16px
    }

    .hero h1 {
      margin: 18px 0 8px
    }

    .muted {
      color: #6b7280
    }

    .quick-actions {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 10px
    }

    .chip {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      border: 1px solid rgba(0, 0, 0, .08);
      background: #fff;
      color: #0b0c10;
      text-decoration: none;
      padding: 8px 12px;
      border-radius: 999px
    }

    .chip:hover {
      background: #fff
    }

    /* VIDEO: How-to section */
    .video-section {
      max-width: 960px;
      margin: 24px auto 8px;
      padding: 16px;
      background: #fff;
      border: 1px solid rgba(0, 0, 0, .08);
      border-radius: 16px;
      box-shadow: 0 6px 20px rgba(0, 0, 0, .06);
    }

    .video-header {
      margin-bottom: 12px
    }

    .video-title {
      font-size: 20px;
      font-weight: 800;
      margin: 0
    }

    .video-desc {
      margin: 0 0 12px;
      color: #6b7280;
      font-size: 14px
    }

    .video-wrap {
      width: 100%;
      aspect-ratio: 16/9;
      border-radius: 12px;
      overflow: hidden;
      background: #000
    }

    .video-wrap iframe {
      width: 100%;
      height: 100%;
      border: 0;
      display: block
    }

    /* SHOWCASE: Demo cards under video */
    .showcase {
      max-width: 1080px;
      margin: 10px auto 28px;
      padding: 0 8px
    }

    .showcase-title {
      font-size: 18px;
      font-weight: 800;
      margin: 14px 0 10px
    }

    .showcase-grid {
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 14px
    }

    @media (max-width:960px) {
      .showcase-grid {
        grid-template-columns: repeat(2, 1fr)
      }
    }

    @media (max-width:640px) {
      .showcase-grid {
        grid-template-columns: 1fr
      }
    }

    .demo-card {
      display: block;
      text-decoration: none;
      color: inherit;
      background: #fff;
      border: 1px solid rgba(0, 0, 0, .08);
      border-radius: 14px;
      box-shadow: 0 8px 24px rgba(0, 0, 0, .05);
      overflow: hidden;
      transition: transform .12s ease, box-shadow .2s ease, border-color .2s ease
    }

    .demo-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 12px 28px rgba(0, 0, 0, .08);
      border-color: rgba(37, 99, 235, .25)
    }

    .demo-thumb {
      background: linear-gradient(180deg, #f3f6ff, #fff);
      height: 150px;
      display: flex;
      align-items: center;
      justify-content: center
    }

    .demo-body {
      padding: 12px 14px
    }

    .demo-title {
      margin: 0 0 4px;
      font-weight: 800
    }

    .demo-desc {
      margin: 0;
      color: #64748b;
      font-size: 14px
    }

    .thumb-svg {
      width: 88%;
      max-width: 320px;
      height: auto;
      opacity: .95
    }

    /* Survey callout */
    .survey-callout {
      max-width: 1080px;
      margin: 24px auto;
      padding: 20px;
      background: #fff;
      border: 1px solid rgba(0, 0, 0, .08);
      border-radius: 16px;
      box-shadow: 0 10px 24px rgba(0, 0, 0, .06);
      display: flex;
      align-items: center;
      gap: 18px;
      flex-wrap: wrap;
    }

    .survey-callout .icon {
      width: 58px;
      height: 58px;
      border-radius: 14px;
      display: grid;
      place-items: center;
      background: #eef2ff;
      color: #2563eb;
      font-size: 26px;
    }

    .survey-callout h2 {
      margin: 0;
      font-size: 20px
    }

    .survey-callout p {
      margin: 4px 0 0;
      color: #6b7280
    }

    .survey-callout .actions {
      margin-left: auto;
      display: flex;
      gap: 10px;
      flex-wrap: wrap
    }

    .survey-callout .btn-primary {
      padding: 10px 16px;
      border-radius: 10px
    }

    .footer {
      padding: 18px 16px;
      color: #6b7280
    }
  </style>
</head>

<body>
  <!-- TOP BAR -->
  <div class="topbar">
    <div class="wrap">
      <div class="tb-left">
        <a class="tb-link" href="#">üìò Facebook</a>
        <a class="tb-link" href="#">üì∏ Instagram</a>
        <form class="tb-search" onsubmit="event.preventDefault(); alert('‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤: '+(this.q.value||''));">
          <input name="q" type="search" placeholder="Please Enter Your Search Keyword..." />
          <button type="submit">üîç</button>
        </form>
      </div>
      <div class="tb-right">
        <a class="tb-link" href="#">üìç Google Maps</a>
        <a class="tb-link" href="tel:025552000">üìû 029-599-8999</a>
        <a class="tb-link" href="mailto:hello@sleepstats.app">‚úâÔ∏è hello@sleepstats.ac.th</a>
      </div>
    </div>
  </div>

  <!-- MAIN NAVBAR -->
  <header class="nav-main">
    <div class="nav-inner2">
      <a class="brand" href="./sleepstat.html">
        <img src="./assets/logo.png" alt="SleepStats Logo" onerror="this.style.display='none'">
        <span>SleepStats</span>
      </a>

      <button class="hamburger" id="hamburger" aria-label="Toggle menu" aria-expanded="false">‚ò∞</button>

      <nav class="menu2" id="menu">
        <a href="./pages/graph-age-sleep.html">Histogram</a>
        <a href="./pages/graph-quality-trend.html">Boxplot</a>
        <a href="./pages/graph-time-distribution.html">Bar chart</a>
        <a href="./pages/survey.html">‡πÅ‡∏ö‡∏ö‡∏™‡∏≠‡∏ö‡∏ñ‡∏≤‡∏°</a>

        <!-- auth area -->
        <span id="authUser"></span>
        <a id="btnLogin" class="btn btn-primary" href="./pages/signin.html">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</a>
        <a id="btnLogout" class="btn" style="display:none" href="javascript:void(0)">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</a>
      </nav>
    </div>
  </header>

  <!-- MAIN -->
  <main class="container">
    <section class="hero">
      <center>
        <h1>Welcome To Stat World</h1>
      </center>
      <center>
        <h3>"‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö"</h3>
      </center>
      <center>
        <p class="muted">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏ô‡∏¥‡∏î‡∏Å‡∏£‡∏≤‡∏ü‡∏à‡∏≤‡∏Å‡πÅ‡∏ñ‡∏ö‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÄ‡∏ä‡∏¥‡∏á‡∏•‡∏∂‡∏Å ‡∏´‡∏£‡∏∑‡∏≠‡∏°‡∏µ‡∏™‡πà‡∏ß‡∏ô‡∏£‡πà‡∏ß‡∏°‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡πÅ‡∏ö‡∏ö‡∏™‡∏≠‡∏ö‡∏ñ‡∏≤‡∏°</p>
      </center>

    </section>

    <!-- How-to Video -->
    <section id="howto" class="video-section container">
      <div class="video-header">
        <h2 class="video-title">‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠: ‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå</h2>
      </div>
      <p class="video-desc">‡∏Ñ‡∏•‡∏¥‡∏õ‡∏™‡∏±‡πâ‡∏ô‡∏™‡∏£‡∏∏‡∏õ‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡∏´‡∏•‡∏±‡∏Å ‡πÅ‡∏•‡∏∞‡∏ß‡∏¥‡∏ò‡∏µ‡∏î‡∏π‡∏Å‡∏£‡∏≤‡∏ü‡∏ï‡πà‡∏≤‡∏á ‡πÜ ‡∏ö‡∏ô SleepStats</p>
      <div class="video-wrap">
        <iframe src="https://www.youtube.com/embed/ZK-rNEhJIDs?si=YiBZYuHUDodw4agn"
          title="SleepStats - ‡∏ß‡∏¥‡∏ò‡∏µ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå" loading="lazy"
          allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
          referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>
      </div>
    </section>

    <!-- Showcase: Demo previews -->
    <section class="showcase">
      <h3 class="showcase-title">‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Å‡∏£‡∏≤‡∏ü (‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡πÅ‡∏ö‡∏ö‡πÄ‡∏ï‡πá‡∏°)</h3>
      <div class="showcase-grid">
        <a class="demo-card" href="./pages/graph-age-sleep.html" aria-label="‡πÄ‡∏õ‡∏¥‡∏î‡∏î‡∏π Histogram ‡∏≠‡∏≤‡∏¢‡∏∏ √ó ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á‡∏ô‡∏≠‡∏ô">
          <div class="demo-thumb">
            <svg viewBox="0 0 300 150" class="thumb-svg" role="img" aria-label="‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á Histogram">
              <rect x="0" y="0" width="300" height="150" fill="white" />
              <g fill="#2563eb">
                <rect x="20" y="90" width="24" height="40" rx="4" />
                <rect x="54" y="70" width="24" height="60" rx="4" />
                <rect x="88" y="40" width="24" height="90" rx="4" />
                <rect x="122" y="30" width="24" height="100" rx="4" />
                <rect x="156" y="48" width="24" height="82" rx="4" />
                <rect x="190" y="78" width="24" height="52" rx="4" />
                <rect x="224" y="96" width="24" height="34" rx="4" />
              </g>
              <line x1="10" y1="130" x2="290" y2="130" stroke="#cbd5e1" stroke-width="2" />
            </svg>
          </div>
          <div class="demo-body">
            <h4 class="demo-title">Histogram ‚Äî ‡∏≠‡∏≤‡∏¢‡∏∏ √ó ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á‡∏ô‡∏≠‡∏ô</h4>
            <p class="demo-desc">‡∏î‡∏π‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏à‡∏≤‡∏¢‡∏ï‡∏±‡∏ß‡∏Ç‡∏≠‡∏á‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á‡∏Å‡∏≤‡∏£‡∏ô‡∏≠‡∏ô‡πÉ‡∏ô‡∏ä‡πà‡∏ß‡∏á‡∏≠‡∏≤‡∏¢‡∏∏‡∏ó‡∏µ‡πà‡∏ï‡πà‡∏≤‡∏á‡∏Å‡∏±‡∏ô</p>
          </div>
        </a>

        <a class="demo-card" href="./pages/graph-quality-trend.html" aria-label="‡πÄ‡∏õ‡∏¥‡∏î‡∏î‡∏π Boxplot ‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡∏Å‡∏≤‡∏£‡∏ô‡∏≠‡∏ô">
          <div class="demo-thumb">
            <svg viewBox="0 0 300 150" class="thumb-svg" role="img" aria-label="‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á Boxplot">
              <rect x="0" y="0" width="300" height="150" fill="white" />
              <g stroke="#16a34a" stroke-width="3" fill="none">
                <line x1="60" y1="30" x2="60" y2="120" />
                <rect x="40" y="60" width="40" height="40" fill="#dcfce7" />
                <line x1="40" y1="80" x2="80" y2="80" />
                <line x1="150" y1="45" x2="150" y2="115" />
                <rect x="130" y="65" width="40" height="30" fill="#dcfce7" />
                <line x1="130" y1="80" x2="170" y2="80" />
                <line x1="240" y1="35" x2="240" y2="125" />
                <rect x="220" y="70" width="40" height="35" fill="#dcfce7" />
                <line x1="220" y1="88" x2="260" y2="88" />
              </g>
            </svg>
          </div>
          <div class="demo-body">
            <h4 class="demo-title">Boxplot ‚Äî ‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡∏Å‡∏≤‡∏£‡∏ô‡∏≠‡∏ô</h4>
            <p class="demo-desc">‡∏™‡∏£‡∏∏‡∏õ‡∏Ñ‡πà‡∏≤‡∏Å‡∏•‡∏≤‡∏á ‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏à‡∏≤‡∏¢ ‡πÅ‡∏•‡∏∞‡∏à‡∏∏‡∏î‡∏ú‡∏¥‡∏î‡∏õ‡∏Å‡∏ï‡∏¥‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡∏Å‡∏≤‡∏£‡∏ô‡∏≠‡∏ô</p>
          </div>
        </a>

        <a class="demo-card" href="./pages/graph-time-distribution.html"
          aria-label="‡πÄ‡∏õ‡∏¥‡∏î‡∏î‡∏π Bar chart ‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏à‡∏≤‡∏¢‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏ô‡∏≠‡∏ô">
          <div class="demo-thumb">
            <svg viewBox="0 0 300 150" class="thumb-svg" role="img" aria-label="‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á Bar chart">
              <rect x="0" y="0" width="300" height="150" fill="white" />
              <g fill="#f59e0b">
                <rect x="35" y="70" width="30" height="60" rx="4" />
                <rect x="85" y="90" width="30" height="40" rx="4" />
                <rect x="135" y="50" width="30" height="80" rx="4" />
                <rect x="185" y="35" width="30" height="95" rx="4" />
                <rect x="235" y="85" width="30" height="45" rx="4" />
              </g>
              <line x1="20" y1="130" x2="280" y2="130" stroke="#cbd5e1" stroke-width="2" />
            </svg>
          </div>
          <div class="demo-body">
            <h4 class="demo-title">Bar chart ‚Äî ‡∏Å‡∏£‡∏∞‡∏à‡∏≤‡∏¢‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏ô‡∏≠‡∏ô</h4>
            <p class="demo-desc">‡∏î‡∏π‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á‡∏ó‡∏µ‡πà‡∏°‡∏±‡∏Å‡πÄ‡∏Ç‡πâ‡∏≤‡∏ô‡∏≠‡∏ô‡∏ö‡πà‡∏≠‡∏¢‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡πÉ‡∏ô‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤</p>
          </div>
        </a>
      </div>
    </section>

    <!-- Survey CTA -->
    <section class="survey-callout">
      <div class="icon">üìù</div>
      <div class="text">
        <h2>‡πÅ‡∏ö‡∏ö‡∏™‡∏≠‡∏ö‡∏ñ‡∏≤‡∏°</h2>
        <p>‡∏≠‡∏¢‡∏≤‡∏Å‡∏£‡πà‡∏ß‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏´‡∏ô‡∏∂‡πà‡∏á‡∏Å‡∏±‡∏ö‡πÄ‡∏£‡∏≤ ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤‡πÉ‡∏´‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏Å‡∏≤‡∏£‡∏ô‡∏≠‡∏ô‡∏Å‡∏±‡∏ö‡πÄ‡∏£‡∏≤‡πÑ‡∏î‡πâ ‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏ô‡πâ‡∏≤</p>
      </div>
      <div class="actions">
        <a class="btn btn-primary" href="./pages/survey.html">‡πÑ‡∏õ‡∏ó‡∏≥‡πÅ‡∏ö‡∏ö‡∏™‡∏≠‡∏ö‡∏ñ‡∏≤‡∏°</a>
      </div>
    </section>
  </main>

  <footer class="container footer">
    <span class="muted">¬© 2025 SleepStats</span>
  </footer>

  <!-- Supabase & Auth Status -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>
    const SUPABASE_URL = "https://nbxuzdrutlvavirpzpjt.supabase.co";
    const SUPABASE_ANON_KEY =
      "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5ieHV6ZHJ1dGx2YXZpcnB6cGp0Iiwicm9zZSI6ImFub24iLCJpYXQiOjE3NTgzODUzMDYsImV4cCI6MjA3Mzk2MTMwNn0.tD4noFRKDFcA9x-A5udQSjkhKuXbccPdohdFjd8Fyo4";
    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY, {
      auth: { persistSession: true, autoRefreshToken: true, detectSessionInUrl: true, storage: window.localStorage }
    });

    const authUser = document.getElementById('authUser');
    const btnLogin = document.getElementById('btnLogin');
    const btnLogout = document.getElementById('btnLogout');

    (function setLoginNext() {
      const next = `${location.origin}/index.html?login=1`;
      const url = new URL(btnLogin.getAttribute('href'), location.origin);
      url.searchParams.set('next', next);
      btnLogin.setAttribute('href', url.pathname + url.search);
    })();

    function avatar(email) {
      const ch = (email || '?').trim()[0]?.toUpperCase() || '?';
      return `<span class="avatar">${ch}</span>`;
    }
    function showLoggedIn(email) {
      authUser.innerHTML = `${avatar(email)}<span>${email}</span>`;
      btnLogin.style.display = 'none';
      btnLogout.style.display = 'inline-block';
    }
    function showLoggedOut() {
      authUser.innerHTML = '';
      btnLogin.style.display = 'inline-block';
      btnLogout.style.display = 'none';
    }

    function readSessionFromLocalStorage() {
      try {
        const ref = SUPABASE_URL.match(/https:\/\/(.*?)\.supabase\.co/)?.[1];
        const key = `sb-${ref}-auth-token`;
        const raw = localStorage.getItem(key);
        if (!raw) return null;
        const parsed = JSON.parse(raw);
        const email =
          parsed?.currentSession?.user?.email ||
          parsed?.user?.email ||
          null;
        return email;
      } catch { return null; }
    }

    async function renderAuth(initial = false) {
      let { data: { session } } = await supabase.auth.getSession();
      if (session?.user?.email) { showLoggedIn(session.user.email); return; }

      const { data: userRes } = await supabase.auth.getUser();
      if (userRes?.user?.email) { showLoggedIn(userRes.user.email); return; }

      const email = readSessionFromLocalStorage();
      if (email) { showLoggedIn(email); return; }

      if (initial) { setTimeout(() => renderAuth(false), 250); return; }
      showLoggedOut();
    }
    renderAuth(true);

    supabase.auth.onAuthStateChange((_evt, session) => {
      if (session?.user?.email) showLoggedIn(session.user.email);
      else showLoggedOut();
    });

    btnLogout?.addEventListener('click', async () => {
      await supabase.auth.signOut();
      location.href = `${location.origin}/index.html`;
    });

    (function () {
      const btn = document.getElementById('hamburger');
      const menu = document.getElementById('menu');
      if (!btn || !menu) return;
      btn.addEventListener('click', () => {
        const open = menu.classList.toggle('open');
        btn.setAttribute('aria-expanded', open ? 'true' : 'false');
      });
    })();
  </script>
</body>

</html>